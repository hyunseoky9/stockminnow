# Stock Minnow Decision Tool

A lightweight, web-based decision support tool for hatchery production and distribution planning for the endangered **Rio Grande silvery minnow**.  
The tool uses a trained deep reinforcement learning (DRL) policy to generate management recommendations based on monitoring and hydrologic inputs.

This application is designed to be:
- easy to use by managers (no local installation required),
- inexpensive to host (runs on free-tier cloud infrastructure),
- transparent and interpretable (context plots accompany recommendations).

---

## Overview

The Stock Minnow Decision Tool supports two annual management decisions:

1. **Spring production decision**  
   Recommend how much hatchery production to initiate based on:
   - recent monitoring-derived catch metrics
   - forecasted spring flow

2. **Fall distribution decision**  
   Recommend how to distribute produced fish among reaches based on:
   - seasonal catch metrics
   - spring flow
   - total hatchery production

Recommendations are generated by a trained **TD3 deep reinforcement learning model** and are accompanied by diagnostic plots showing how current conditions compare to historical simulation outcomes.

---

## Live Deployment

The app is deployed on **Render (Free tier)** and is intended for very low-frequency use (e.g., 1â€“2 times per year by a single manager).

Cold starts are expected on first use, but subsequent interactions are fast once the model is loaded into memory.

---

## Backend Details

- **Framework:** Flask
- **Model:** TD3 (PyTorch, CPU-only)
- **Caching:** Model and normalization objects are loaded once per worker and cached in memory
- **Plots:**
  - Matplotlib (server-side, base64-encoded PNGs)
  - Plotly (client-side, rendered in browser)

To ensure compatibility with constrained hosting environments:
- heavy dependencies (e.g., `scipy`) are avoided at runtime
- non-interactive Matplotlib backend (`Agg`) is used
- Plotly image export via Chrome/Kaleido is disabled

---

## Dependencies

Minimal production dependencies (see `requirements.txt`):

- Flask
- flask-cors
- gunicorn
- numpy
- pandas
- torch (CPU)
- matplotlib
- plotly

---

## Local Development

To run locally:

```bash
pip install -r requirements.txt
python app.py
```
Then open:
http://localhost:5000